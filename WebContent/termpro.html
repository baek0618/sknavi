<!DOCTYPE html>
<html>
<head>
    <style>
        table, th, td {
            border: 1px solid black;
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script>
        // XMLHttpRequest 객체를 생성하는 함수 2-28

        function writedata(json) {
            var newline = '';

            for (var i = 0; i < json.length; i++) {
                newline += '<tr>';
                for (var key in json[i]) {
                    newline += '<td>' + json[i][key] + '</td>';
                    //output += '<h1>' + i + ':' + json[i][key] + '</h1>';
                }
                newline += '</tr>';
            }
            document.getElementById('itemTable').innerHTML += newline;
        };

        function readjsondata(request) {
            // 쓰는 부분

            var json;
            var output;
            request.onreadystatechange = function (event) {
                if (request.readyState == 4) {
                    if (request.status == 200) {
                        // 데이터를 가공합니다. - json string을 eval로 string으로 바꾸어준다.
                        // json이 응답을 객체로 가지게 된다
                        json = eval('(' + request.responseText + ')');
                    };
                };
            };

            request.open('GET', '/products', false);
            request.send();

            return json;

        };

        function delItem() {
            var lo_table = document.getElementById("itemTable");
            var row_index = lo_table.rows.length - 1;      // 테이블(TR) row 개수s

            for (var i = 0; i < row_index; i++) {
                lo_table.deleteRow(1)
            }
        }
    </script>
    <script>
        $(document).ready(function () {


            $('#submit').click(function () {

                var id = $('#id').val();
                var name = $('#name').val();
                var price = $('#price').val();
                var stock = $('#stock').val();
                var order = $('#order').val();
                var category = $('#category').val();
                delItem();
                $.ajax({
                    url: '/products',
                    type: 'post',
                    dataType: 'text',
                    data: {
                        id : id,
                        name: name,
                        price: price,
                        stock: stock,
                        order : order,
                        category:category
                    },
                    success: function (data) {


                    }
                });

                $.getJSON('/products', function (data) {
                    $.each(data, function (key, value)  {
                        //$('body').append('<h1>' + value.name + ' : ' + value.unitPrice + '</h1>');
                        $('#itemTable').append('<tr><td>' + value.productId + '</td>' + '<td>' + value.name + '</td>'
                                + '<td>' + value.unitPrice + '</td>' + '<td>' + value.unitsInStock + '</td>' + '<td>' + value.unitsInOrder + '</td>' + '<td>' + value.category + '</td></tr>');
                    });
                });

            });


            $('#get').click(function () {


                delItem();


                $.getJSON('/products', function (data) {
                    $()
                    $.each(data, function (key, value) {
                        //$('body').append('<h1>' + value.name + ' : ' + value.unitPrice + '</h1>');
                        $('#itemTable').append('<tr><td>' + value.productId + '</td>' + '<td>' + value.name + '</td>'
                                + '<td>' + value.unitPrice + '</td>' + '<td>' + value.unitsInStock + '</td>' + '<td>' + value.unitsInOrder + '</td>' + '<td>' + value.category + '</td></tr>');

                    });
                });

            });

            $('#getone').click(function () {

                var id = $('#getid').val();

                //delItem();


                $('#itemTable > tbody:last > tr:gt(1)').remove();


                $.ajax({
                    url: '/products/' + id,
                    type: 'get',
                    dataType: 'text',
                    data: {
                        //id: id,
                    },
                    success: function (data) {

                        //eval('([' + request.responseText + '])');
                        var d = eval('([' + data + '])');

                        $.each(d, function (key, value) {
                            //$('body').append('<h1>' + value.name + ' : ' + value.unitPrice + '</h1>');
                            $('#itemTable').append('<tr><td>' + value.productId + '</td>' + '<td>' + value.name + '</td>'
                                    + '<td>' + value.unitPrice + '</td>' + '<td>' + value.unitsInStock + '</td>' + '<td>' + value.unitsInOrder + '</td>' + '<td>' + value.category + '</td></tr>');

                        });
                    }
                });


            });



            $('#put').click(function () {

                var id = $('#changeid').val();
                var name = $('#newname').val();
                var price = $('#newprice').val();
                var stock = $('#newstock').val();
                var order = $('#neworder').val();
                var category = $('#newcategory').val();
                delItem();

                $.ajax({
                    url: '/products/'+id,
                    type: 'put',
                    dataType: 'text',
                    data: {
                        //id: id,
                        name: name,
                        price: price,
                        stock: stock,
                        order: order,
                        category: category
                    },
                    success: function (data) {

                    }
                });


                $.getJSON('/products', function (data) {
                    $.each(data, function (key, value) {
                        //$('body').append('<h1>' + value.name + ' : ' + value.unitPrice + '</h1>');
                        $('#itemTable').append('<tr><td>' + value.productId + '</td>' + '<td>' + value.name + '</td>'
                                + '<td>' + value.unitPrice + '</td>' + '<td>' + value.unitsInStock + '</td>' + '<td>' + value.unitsInOrder + '</td>' + '<td>' + value.category + '</td></tr>');

                    });
                });

            });


            $('#delete').click(function () {
                var id = $('#id2').val();

                delItem();

                $.ajax({
                    url: '/products/'+id,
                    type: 'delete',
                    dataType: 'text',
                    success: function (data) {

                    }
                });


                $.getJSON('/products', function (data) {
                    $.each(data, function (key, value) {
                        //$('body').append('<h1>' + value.name + ' : ' + value.unitPrice + '</h1>');
                        $('#itemTable').append('<tr><td>' + value.productId + '</td>' + '<td>' + value.name + '</td>'
                                + '<td>' + value.unitPrice + '</td>' + '<td>' + value.unitsInStock + '</td>' + '<td>' + value.unitsInOrder + '</td>' + '<td>' + value.category + '</td></tr>');

                    });
                });

            });



        });

        window.onload = function () {



            document.getElementById('itemform').onsubmit = function () {
                return false;
            }
            document.getElementById('deleteform').onsubmit = function () {
                return false;
            }
            document.getElementById('getform').onsubmit = function () {
                return false;
            }
            document.getElementById('changeform').onsubmit = function () {
                return false;
            }
        };
    </script>
    <title> XMLHttpRequest </title>
</head>
<body>
    <h1>20131072 우연서</h1>


    <fieldset>
        <legend>추가 할 정보 입력</legend>
        <form id="itemform">

            상품 ID : <input id="id" /> <br /><!--  서버쪽에서 추출한다고 해 놓은 이름이랑 같게 해 놓아야 한다.-->
            상품 이름 : <input id="name" /> <br />
            상품 가격 : <input id="price" /> <br />
            상품 재고량 : <input id="stock" /><br />
            상품 주문량 : <input id="order" /><br />
            상품 분류명 : <input id="category" /><br />
            <input type="submit" id="submit" value="POST" />


        </form>
    </fieldset>
    <br />
    <fieldset>
        <legend>수정할 정보 입력</legend>
        <form id="changeform">


            수정 할 상품 ID : <input id="changeid" /> <br /><!--  서버쪽에서 추출한다고 해 놓은 이름이랑 같게 해 놓아야 한다.-->
            해당 ID에서 수정할 정보 <br />
            상품 이름 : <input id="newname" /> <br />
            상품 가격 : <input id="newprice" /> <br />
            상품 재고량 : <input id="newstock" /><br />
            상품 주문량 : <input id="neworder" /><br />
            상품 분류명 : <input id="newcategory" /><br />


            <button id="put" value="put">PUT</button>
        </form>
    </fieldset>
    <br />
    <fieldset>
        <legend>삭제 정보 입력</legend>
        <form id="deleteform">

            상품 ID : <input id="id2" /> <br /><!--  서버쪽에서 추출한다고 해 놓은 이름이랑 같게 해 놓아야 한다.-->

            <button id="delete" value="delete">DELETE</button>
        </form>
    </fieldset>
    <br />
    <fieldset>
        <legend>얻을 상품 정보 입력</legend>
        <form id="getform">

            상품 ID : <input id="getid" /> <br /><!--  서버쪽에서 추출한다고 해 놓은 이름이랑 같게 해 놓아야 한다.-->


            <button id="get" value="get">GET</button>
            <button id="getone" value="getone">GET_ONE</button>

            <!--<button id="delete" value="delete">DELETE</button>-->
        </form>
    </fieldset>


    <select id="standardBox">
        <option value="name">이름</option>
        <option value="id">ID</option>
    </select>

    <select id="orderBox">
        <option value="desc">내림차순</option>
        <option value="aesc">오름차순</option>
    </select>


    <table id="itemTable">

        <tr>
            <th>  상품 ID </th>
            <th>  상품 이름 </th>
            <th>  상품 가격 </th>
            <th>  상품 재고량 </th>
            <th>  상품 주문량 </th>
            <th>  상품 분류명 </th>
        </tr>

    </table>

    <h1 id="test"></h1>

</body>
</html>
